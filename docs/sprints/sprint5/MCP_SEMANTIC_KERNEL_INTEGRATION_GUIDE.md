# MCP + Semantic Kernel Integration Guide

**Date**: October 10, 2025  
**Status**: Documentation  
**Purpose**: Explain how MCP tools connect to UI through Semantic Kernel

---

## üîÑ Complete Data Flow

### 1. Frontend UI ‚Üí Backend API ‚Üí MCP Tools

```
User drags & drops CSV file
  ‚Üì
ForecastDatasetPanel.tsx (handleDrop)
  ‚Üì
DatasetService.uploadDataset(file)
  ‚Üì
POST /v3/datasets/upload
  ‚Üì
Backend stores file in data/datasets/
  ‚Üì
MCP tools can access via list_finance_datasets, summarize_financial_dataset
```

### 2. User Chat ‚Üí Agent ‚Üí MCP Tools ‚Üí Response

```
User types message in HomeInput.tsx
  ‚Üì
WebSocket message to backend
  ‚Üì
OrchestrationManager creates agent team
  ‚Üì
MagenticAgentFactory.create_agent_from_config()
  ‚Üì
Agent initialized with MCP plugin (if use_mcp: true)
  ‚Üì
Agent calls MCP tools via Semantic Kernel
  ‚Üì
Results stream back to frontend via WebSocket
```

---

## üì¶ Key Components

### Frontend (React/TypeScript)

**Drag & Drop Components:**
- `src/frontend/src/components/content/ForecastDatasetPanel.tsx` - Basic dataset upload
- `src/frontend/src/components/content/EnhancedForecastDatasetPanel.tsx` - Multi-file upload
- `src/frontend/src/pages/AnalyticsDashboard.tsx` - Analytics dashboard with KPIs

**Data Flow:**
```typescript
// 1. User drags file
handleDrop(event: React.DragEvent<HTMLDivElement>)
  ‚Üì
// 2. Upload via service
await DatasetService.uploadDataset(file)
  ‚Üì
// 3. Backend API call
POST /v3/datasets/upload
```

**Services:**
- `src/frontend/src/services/DatasetService.tsx` - API client for datasets
- `src/frontend/src/api/apiClient.ts` - HTTP client wrapper

### Backend (Python/FastAPI)

**API Endpoints:**
- `src/backend/v3/api/dataset_router.py` - Handles `/v3/datasets/*` routes
  - `POST /upload` - Upload CSV/Excel files
  - `GET /` - List all datasets
  - `DELETE /{dataset_id}` - Delete dataset
  - `GET /{dataset_id}/download` - Download dataset

**Storage:**
- Files stored in `data/datasets/`
- Metadata tracked in memory or database
- MCP server reads from same directory

### MCP Server (Python/FastMCP)

**Server Setup:**
```python
# src/mcp_server/mcp_server.py
factory = MCPToolFactory()

# Register all services
factory.register_service(FinanceService())
factory.register_service(CustomerAnalyticsService())
factory.register_service(OperationsAnalyticsService())
factory.register_service(PricingAnalyticsService())
factory.register_service(MarketingAnalyticsService())
# ... other services

# Create FastMCP server
mcp = factory.create_mcp_server(name="MACAE MCP Server")
```

**Tool Registration:**
```python
# Each service registers its tools
class FinanceService(MCPToolBase):
    def register_tools(self, mcp: FastMCP):
        @mcp.tool()
        def list_finance_datasets() -> str:
            """List all available financial datasets."""
            # Implementation
        
        @mcp.tool()
        def generate_financial_forecast(...) -> str:
            """Generate forecast with advanced methods."""
            # Implementation
```

---

## üîå Semantic Kernel Integration

### MCP Plugin Creation

**Step 1: Agent Receives MCP Config**
```python
# src/backend/v3/magentic_agents/models/agent_models.py
@dataclass
class MCPConfig:
    url: str  # MCP server endpoint
    name: str  # Plugin name
    description: str
    tenant_id: str
    client_id: str
    
    @classmethod
    def from_env(cls) -> "MCPConfig":
        return cls(
            url=config.MCP_SERVER_ENDPOINT,  # http://localhost:8001
            name=config.MCP_SERVER_NAME,      # "MACAE MCP Server"
            description=config.MCP_SERVER_DESCRIPTION,
            tenant_id=config.AZURE_TENANT_ID,
            client_id=config.AZURE_CLIENT_ID,
        )
```

**Step 2: Agent Factory Reads Team Config**
```python
# src/backend/v3/magentic_agents/magentic_agent_factory.py
async def create_agent_from_config(self, agent_obj: SimpleNamespace):
    # Check if agent should use MCP
    use_mcp = getattr(agent_obj, 'use_mcp', False)
    
    # Create MCP config if enabled
    mcp_config = MCPConfig.from_env() if use_mcp else None
    
    # Create agent with MCP config
    if use_reasoning:
        agent = ReasoningAgentTemplate(
            agent_name=agent_obj.name,
            # ...
            mcp_config=mcp_config  # ‚Üê Passed to agent
        )
    else:
        agent = FoundryAgentTemplate(
            agent_name=agent_obj.name,
            # ...
            mcp_config=mcp_config  # ‚Üê Passed to agent
        )
    
    await agent.open()  # ‚Üê Initializes MCP plugin
    return agent
```

**Step 3: MCPEnabledBase Initializes Plugin**
```python
# src/backend/v3/magentic_agents/common/lifecycle.py
class MCPEnabledBase:
    async def _enter_mcp_if_configured(self) -> None:
        if not self.mcp_cfg:
            return
        
        # Create MCPStreamableHttpPlugin
        plugin = MCPStreamableHttpPlugin(
            name=self.mcp_cfg.name,
            description=self.mcp_cfg.description,
            url=self.mcp_cfg.url,  # ‚Üê Connects to MCP server
        )
        
        # Enter async context
        self.mcp_plugin = await self._stack.enter_async_context(plugin)
```

**Step 4: Agent Adds Plugin to Semantic Kernel**

*For Reasoning Agents (o1-preview):*
```python
# src/backend/v3/magentic_agents/reasoning_agent.py
async def _after_open(self) -> None:
    self.kernel = Kernel()
    
    # Add Azure OpenAI service
    chat = AzureChatCompletion(...)
    self.kernel.add_service(chat)
    
    # ‚ú® Add MCP plugin to kernel
    if self.mcp_plugin:
        self.kernel.add_plugin(
            self.mcp_plugin, 
            plugin_name="mcp_tools"  # ‚Üê All tools accessible as mcp_tools.*
        )
    
    # Create agent
    self._agent = ChatCompletionAgent(
        kernel=self.kernel,
        name=self.agent_name,
        # ...
    )
```

*For Foundry Agents (gpt-4):*
```python
# src/backend/v3/magentic_agents/foundry_agent.py
async def _after_open(self) -> None:
    # Create agent definition in Foundry
    definition = await self.client.agents.create_agent(
        model=self.model_deployment_name,
        name=self.agent_name,
        # ...
    )
    
    # ‚ú® Add MCP plugin
    plugins = [self.mcp_plugin] if self.mcp_plugin else []
    
    self._agent = AzureAIAgent(
        client=self.client,
        definition=definition,
        plugins=plugins  # ‚Üê Plugin added to agent
    )
```

---

## üéØ How Agents Call MCP Tools

### Option 1: Automatic Tool Discovery (Semantic Kernel)

When an agent is initialized with an MCP plugin, Semantic Kernel automatically:
1. Queries the MCP server for available tools
2. Adds them to the kernel's function registry
3. Makes them available for the LLM to call

**Example Agent System Message:**
```python
system_message = """
You are a Financial Forecasting Specialist.

Available tools: 
- generate_financial_forecast
- evaluate_forecast_models
- list_finance_datasets
- summarize_financial_dataset

Use these tools to analyze data and create forecasts.
"""
```

### Option 2: Explicit Tool Calls (Agent Team Config)

**Agent Team JSON:**
```json
{
  "agents": [
    {
      "name": "FinanceForecastingAgent",
      "deployment_name": "gpt-4.1-mini",
      "use_mcp": true,  ‚Üê Enables MCP plugin
      "system_message": "You are a forecasting expert. Use MCP tools: generate_financial_forecast, evaluate_forecast_models, list_finance_datasets.",
      "description": "Forecasts revenue using advanced algorithms"
    }
  ]
}
```

**How it works:**
1. User asks: "Forecast revenue for next 6 months"
2. Agent sees `use_mcp: true` in config
3. MagenticAgentFactory creates `MCPConfig.from_env()`
4. Agent is initialized with MCP plugin
5. Semantic Kernel discovers all MCP tools
6. Agent can call `generate_financial_forecast(...)` naturally

---

## ‚úÖ Current Status - What Works

### ‚úÖ MCP Server
- All 9 services registered and working
- 25+ MCP tools available
- FastMCP server runs on port 8001
- Tools tested via Sprint 1-3 test suites

### ‚úÖ Agent Team Configurations
- 8 agent teams configured
- All have `use_mcp: true` for specialized agents
- System messages list available tools
- Team configs match platform schema

### ‚úÖ Frontend Drag & Drop
- Dataset upload works
- Multi-file upload supported
- Files stored in `data/datasets/`
- MCP tools can access uploaded files

### ‚úÖ Backend API
- `/v3/datasets/*` endpoints functional
- Upload, list, delete, download all working
- Analytics endpoints created (`/v3/analytics/*`)

### ‚úÖ Semantic Kernel Integration
- `MCPStreamableHttpPlugin` properly initialized
- Plugins added to Reasoning & Foundry agents
- Tool discovery automatic
- Agent can invoke MCP tools

---

## ‚ö†Ô∏è Potential Issues & Fixes

### Issue 1: MCP Server Not Running

**Symptom:** Agents can't call MCP tools, get connection errors

**Fix:**
```bash
# Start MCP server
cd src/mcp_server
python -m mcp_server

# Or via Docker
docker-compose up mcp-server
```

**Environment Variable:**
```bash
MCP_SERVER_ENDPOINT=http://localhost:8001
MCP_SERVER_NAME="MACAE MCP Server"
MCP_SERVER_DESCRIPTION="Multi-Agent Custom Automation Engine MCP Tools"
```

### Issue 2: Agent Not Configured for MCP

**Symptom:** Agent doesn't use MCP tools even though they're available

**Check:**
```json
// In agent team JSON
{
  "agents": [
    {
      "name": "YourAgent",
      "use_mcp": true,  ‚Üê Must be true
      "system_message": "... Available tools: tool1, tool2, ..."  ‚Üê List tools
    }
  ]
}
```

**Fix:** Ensure all specialized agents have:
1. `"use_mcp": true`
2. System message mentions available tools
3. Agent isn't ProxyAgent (ProxyAgent doesn't use MCP)

### Issue 3: Dataset Not Found

**Symptom:** MCP tool says dataset not found after upload

**Root Cause:** MCP server and backend use different directories

**Check:**
```python
# Backend uploads to:
data/datasets/

# MCP server reads from:
# Configured in mcp_server/config/settings.py
DATASET_PATH = Path("../../data/datasets/")
```

**Fix:** Ensure both use the same path (already configured correctly)

### Issue 4: Tool Names Don't Match

**Symptom:** Agent tries to call a tool but it doesn't exist

**Check Tool Registry:**
```python
# All registered MCP tools:
# Finance:
- list_finance_datasets
- summarize_financial_dataset
- generate_financial_forecast
- evaluate_forecast_models
- calculate_financial_metrics

# Customer Analytics:
- analyze_customer_churn
- segment_customers
- predict_customer_lifetime_value
- analyze_sentiment_trends

# Operations Analytics:
- forecast_delivery_performance
- optimize_inventory
- analyze_warehouse_incidents
- get_operations_summary

# Pricing Analytics:
- competitive_price_analysis
- optimize_discount_strategy
- forecast_revenue_by_category

# Marketing Analytics:
- analyze_campaign_effectiveness
- predict_engagement
- optimize_loyalty_program
```

**Fix:** Update agent system messages to use exact tool names

---

## üîß Configuration Checklist

### Environment Variables (.env)

```bash
# MCP Server
MCP_SERVER_ENDPOINT=http://localhost:8001
MCP_SERVER_NAME=MACAE MCP Server
MCP_SERVER_DESCRIPTION=Multi-Agent Custom Automation Engine MCP Tools

# Azure
AZURE_TENANT_ID=your-tenant-id
AZURE_CLIENT_ID=your-client-id
AZURE_OPENAI_ENDPOINT=https://your-openai.openai.azure.com/

# Dataset Storage
DATASET_PATH=../../data/datasets/
```

### Agent Team JSON Schema

```json
{
  "id": "5",
  "team_id": "team-your-team",
  "name": "Your Team Name",
  "agents": [
    {
      "name": "YourAgent",
      "deployment_name": "gpt-4.1-mini",
      "use_mcp": true,  ‚Üê REQUIRED
      "use_rag": false,
      "use_bing": false,
      "use_reasoning": false,
      "coding_tools": false,
      "system_message": "You are an expert. Available tools: tool1, tool2",  ‚Üê RECOMMENDED
      "description": "Agent description"
    }
  ]
}
```

---

## üß™ Testing MCP Integration

### Test 1: Verify MCP Server Running
```bash
curl http://localhost:8001/health
# Should return: {"status": "healthy"}
```

### Test 2: List Available Tools
```bash
# Via MCP protocol
curl http://localhost:8001/tools/list
```

### Test 3: Upload Dataset & Verify Access
```bash
# 1. Upload via frontend (drag & drop)
# 2. Check backend storage
ls data/datasets/
# 3. Call MCP tool
curl -X POST http://localhost:8001/tools/list_finance_datasets
```

### Test 4: Agent Uses MCP Tool
```python
# Create agent with MCP enabled
agent_config = {
    "name": "TestAgent",
    "deployment_name": "gpt-4.1-mini",
    "use_mcp": True,
    "system_message": "Use list_finance_datasets to show available data."
}

# Agent should successfully call the tool
response = await agent.invoke("What datasets are available?")
```

---

## üéì Adding New MCP Tools

### Step 1: Create Tool in Service

```python
# src/mcp_server/services/your_service.py
class YourService(MCPToolBase):
    def __init__(self):
        super().__init__(domain=Domain.YOUR_DOMAIN)
    
    def register_tools(self, mcp: FastMCP):
        @mcp.tool()
        def your_new_tool(param1: str, param2: int) -> str:
            """
            Tool description for LLM.
            
            Args:
                param1: Description of param1
                param2: Description of param2
            
            Returns:
                Description of return value
            """
            # Implementation
            return result
    
    @property
    def tool_count(self) -> int:
        return 1  # Update count
```

### Step 2: Register Service

```python
# src/mcp_server/mcp_server.py
from services.your_service import YourService

factory.register_service(YourService())
```

### Step 3: Update Agent System Message

```json
{
  "system_message": "... Available tools: your_new_tool, ..."
}
```

### Step 4: Test Tool

```python
# tests/your_service_tests.py
def test_your_new_tool():
    result = your_new_tool("test", 42)
    assert result is not None
```

---

## üìä Architecture Diagram

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        FRONTEND (React)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ ForecastDatasetPanel  ‚îÇ    ‚îÇ  AnalyticsDashboard     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Drag & Drop        ‚îÇ    ‚îÇ  - KPI Cards            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Upload CSV/Excel   ‚îÇ    ‚îÇ  - Charts               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ              ‚îÇ                             ‚îÇ                 ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ                            ‚îÇ                                 ‚îÇ
‚îÇ                    DatasetService.tsx                        ‚îÇ
‚îÇ                            ‚îÇ                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ HTTP POST/GET
                             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BACKEND API (FastAPI)                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ            Dataset Router (/v3/datasets/*)           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - POST /upload  - GET /  - DELETE /{id}             ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                           ‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ           OrchestrationManager                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ     MagenticAgentFactory                     ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Reads agent team JSON                     ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Creates MCPConfig if use_mcp: true       ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Initializes agents with MCP plugin        ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                        ‚îÇ                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ         MCPEnabledBase / AzureAgentBase             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Creates MCPStreamableHttpPlugin                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Connects to MCP server                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Adds plugin to Semantic Kernel                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ HTTP (MCP Protocol)
                         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   MCP SERVER (FastMCP)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              MCPToolFactory                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - FinanceService (5 tools)                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - CustomerAnalyticsService (4 tools)               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - OperationsAnalyticsService (4 tools)             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - PricingAnalyticsService (3 tools)                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - MarketingAnalyticsService (3 tools)              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - HRService, MarketingService, etc.                ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                       ‚îÇ                                     ‚îÇ
‚îÇ                       ‚Üì                                     ‚îÇ
‚îÇ              data/datasets/*.csv                            ‚îÇ
‚îÇ              (Shared with backend)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Summary

### What's Working ‚úÖ
1. **Frontend ‚Üí Backend**: Dataset upload via drag & drop
2. **Backend ‚Üí Storage**: Files saved to `data/datasets/`
3. **MCP Server ‚Üí Storage**: Tools read from same directory
4. **Agent ‚Üí MCP**: Semantic Kernel plugin integration
5. **Tool Discovery**: Automatic via MCPStreamableHttpPlugin
6. **Agent Teams**: All configured with correct schema

### What Needs Attention ‚ö†Ô∏è
1. **Ensure MCP server is running** before starting backend
2. **Verify environment variables** are set for MCP config
3. **Test end-to-end flow** with actual user scenarios
4. **Monitor logs** for connection errors during agent initialization

### Next Steps üöÄ
1. Deploy MCP server alongside backend
2. Run end-to-end integration tests
3. Create user documentation for dataset upload flow
4. Add monitoring/health checks for MCP connectivity

